# Internet Shop

## The list of table

### Products Table
- product_id (PK)
- description
- price
- category_id (FK linking to a **categories** table)
- image_url

### ProductsOfCategoryPage Table
- category_id (PK)
- name

### Customers Table 
- customer_id (PK)
- user_id (FK linking to a **users** table)
- first_name
- last_name
- email (FK linking to a **users** table)
- phone_number
- ZIP code
- address


### Orders Table

- order_id (PK)
- customer_id (FK linking to the **customers** table)
- delivery_requirement ("needed - true"  "not needed - false") default - "false"
- received_status ("pending - false" "delivered - true") default - "false"
- type_of_payment ("cash" or "card") default "cash"
- payment_status ("false - not paid", "true - paid") default - "false"

### Order Details Table (for storing individual products within an order)

- order_detail_id (PK)
- order_id (FK linking to the **orders** table)
- product_id (FK linking to the **products** table)
- quantity
- price  (FK linking to the **products** table)
- amount (calculated)

### Carts Table (for storing items in a user's shopping cart before purchase)

- cart_id (PK)
- customer_id (FK linking to the **customers** table)
- cart_item_id (FK linking to the **cart items** table)

### Cart Items Table

- cart_item_id (PK)
- cart_id (FK linking to the **cart** table)
- order_id (FK linking to the **orders** table)
- product_id (FK linking to the **products** table)
- quantity
- price
- amount (calculated)

### Payments Table

- payment_id
- order_id (FK linking to the **orders** table)
- transaction_date
- amount
- payment_method VARCHAR(50),
- transaction_status (???)



## Исходные положения


Принцип работы интернет магазина:

- Люди заходят на сайт первоначально без регистрации (аутентификации).
- Все товары разделены на категории.
- После выбора категории в основном блоке открываются товары в виде галереи с фото, с краткими характеристиками,
  ценой и доступностью на складе.
- Возможна сортировка товаров по цене, названию, популярности ...
- При выборе интересующего товара в основном блоке открывается окно с более крупным фото и развернутыми
  характеристиками. Также появлется кнопка для перемещения товара в корзину. Если товар перемещен в корзину,
  то окно автоматически закрывается. Автоматического перехода в корзину не происходит и покупатель может
  продолжить выбор товаров.
- Если в корзине уже есть товары, то зачок индикации корзины меняется соответствующим образом.
- При нажатии на значек корзины покупатель переходит в соответствующее окно корзины (или на страницу
  корзины).
- По умолчанию товар в корзине выбирается в единичном количестве.
- Количество данного товара  можно менять в корзине.
- Товары в корзине можно удалять. Если после удаления товара в корзине не осталось ни одного товара,
  окно корзины автоматически закрывается.
- Для покупателя выводится количество, ценна единицы товара и сумма. Также выводится и суммарная стоимость всех
  выбранных товаров.
- Если покупатель решил оформить заказ выбраных товаров, то в случае, если он уже прошел аутентификацию,
- ему открывается форма для составления заказа. В противном случае, он отправляется на страницу регистрации.
- В форме он заполняет (данные полей могут автоматически вводиться из заполненных при регистрации
  или из данных кабинета пользователя) следующие данные:
  - ФИО;
  - email;
  - адрес;
  - телефон;
  - ..........
    Поля есть как обязательные так и нет.
- После подтверждения отправки формы заказа, пользователь попадает на страницу оплаты, где происходит формальная
  оплата заказов.
- Платежи выполняются всегда удачно после заполнения платежной формы. Несоответствие (ошибка может
  быть только в сумме).
- Платеж может быть выполнен только полной суммой стоимости заказа.
- Товары на складе находятся в установленном изначально количестве, которое потом можно изменять через
  панель администратора.
- Оплата, отгрузка и доставка товаров происходит пока в автоматическом режиме (виртуально).
- После отгрузки со склада товаров их количество уменьшается.
- Возможно сделать виртуальный счет магазина, который пополняется после оплаты.
- У каждого пользователя существует свой личный кабинет, где он может просмотреть и изменить свои 
  личные данные, историю заказов и платежей.
- Существует админ панель для управления интернет магазином. Добавление товаров, корректировка
  данных товара, создание новых категорий ...


- .............................................................


## 2024.04.03  
Не доходил параметр при нажатии кнопки мыши на выбранный продукт на 
страницу Products
  navigate(`${ROUTE.PRODUCT_CURRENT.replace(":productKey", productKey)}`
поменял 'productId' на 'productKey'.
Переделал компонент RegisterPage на MUI. Добавил поле 'Name'. Валидацию сделал
по схеме при помощи Yap.

## 2024.04.07
На фронте и на беке добавил маршрут login. Работает как-то, но пока все еще
неопределенно.

## 2024.04.10
Продолжаю делать аутентификацию. Делаю подтверждение по email. Email приходит, но при
переходе по ссылке не работает подтверждение (в базу соответствующее поле не 
прописывается). Начал делать все через API. Разобрал все кейсы при аутентификации,
теперь начинаю делать необходимую страницу для верификации email.

## 2024.04.14
Продолжаю делать аутентификацию. Делаю подтверждение по email. Изменил стандартный
маршрут '/email/verification-notification'. Добавил поиск пользователя по адресу
почты, приходящего с фронта, как полезная нагрузка. Убрал миддлваре auth. Верификационный
емейл высылается.

## 2024.04.25 _ 1
Работает аутентификация с использованием токена. Sanctum используется часично. Токен
генерируется при помощи Sanctum. Важно отбросить все перед превиксом (включая символ |).
Миддлеваре 'auth:sanctum' не заработал. Создал свой 'auth_jwt'. 
Верификацию по email тоже сделал самостоятельно.

## 2024.04.25 _ 2
 В RegistrationPage добавил поле confirmPassword и чекбокс agreeToProcessing. Пользователь
 регистрируется. Высылается почему-то два емейла для подтверждения. Скорее всего надо
 убрать сервис повторной высылки емейла. При подтверждении емейла по ссылке все работае.
 В базе данных все записывается.

## 2024.04.26
Добавил кнопку аккаунта и подсказки ко всем кнопкам в заголовке. Создал болванку роута
DASHBOARD.

## 2024.04.28 
Создал таблицы Orders, Order Details.

## 2024.04.30 - 1
Добавил текстовое поле 'customer_notes' в таблицу Orders. Сделал в реакт миддлваре для 
защиты маршрутов (<WithAuthCheck> <OrderForm /> </WithAuthCheck>). 

## 2024.04.30 - 2
Переделал OrderForm и добавил checkbox.

## 2024.04.30 - 2
Добавил в OrderForm загрузку по умолчанию в поле email значение поля users.email авторизованного
пользователя. Для этого задействовал ранее тестовы маршрут 'post::/user'. Сделал UserController. 
Утилита getUserByEmail получает email текущего пользователя, а утилита getUser служит все еще для
тестовых целей.

## 2024.05.04
Добавил в таблицу 'customer' поле 'customer_notes'.Сделал необязательные поля для таблицы 
'customers' нулевыми по умолчанию ('last_name', 'phone_number', 'zip_code', 'address').
Добавил в таблицу 'orders' поле 'advance_payment'. Сделал OrderController  роут '/order'.
Утилитой placeOrder производим запись из фронтенда (форма OrderPage и CartPage) в таблицы
базы данных 'customer', 'orders', 'order_details'.

## 2024.05.06
Добавил обработку ошибок на сервере. Передаю на фронт дополнительно параметры 
'total_amount', 'order_id', 'created_at'. Сверяю суммы заказа на фроте и сервере. Если
совпадает вывожу в модальное окно (раньше было в alert) информацию по заказу.

## 2024.05.07
Дополнительно к выводу в модальное окно, производится отправка на почту покупателя информации
о размещении заказа с его характеристиками.

## 2024.05.07 
Переделал ProductPage на работу с базой данных. Теперь из DropDownMenu в prodactKey передается 
id вместо name. Проявилось несоответствие номеров фото в конфиге и базе данных.

## 2024.05.10
Добавил формы в личный кабинет пользователя. Пока без связи с бекендом.

## 2024.05.12 
Работает обновление в личном кабинете обновление данных пользователя и смена пароля.